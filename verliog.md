# 4-Key + 4-LED 数字时钟系统：按键与LED状态对照

## 1. LED 显示规则（统一约定）

- **LED[3:0] 输出 1 个十进制数字的 BCD**（0~9）
  - 0 → `0000`
  - 1 → `0001`
  - 2 → `0010`
  - 3 → `0011`
  - 4 → `0100`
  - 5 → `0101`
  - 6 → `0110`
  - 7 → `0111`
  - 8 → `1000`
  - 9 → `1001`
- **轮播显示 4 位**（每 `DISP_MS_PER_DIG` ms 切换一位）  
  设轮播索引 `disp_idx = 0,1,2,3`，依次显示第 1~第 4 位数字。
- **闪烁/空白占位**：显示 `1111` 作为“空白/占位符”（用于提示正在设置/暂停等状态）。

---

## 2. 按键定义（KEY0~KEY3）

- **KEY0 = MODE**：模式切换  
  `CLOCK → SET_H → SET_M → ALARM_SET → STOPWATCH → CLOCK`
- **KEY1 = INC**：当前字段 +1
- **KEY2 = DEC**：当前字段 -1
- **KEY3 = FUNC**：功能键（不同模式含义不同）；在 STOPWATCH 中 **长按**执行清零

> 说明：时钟走时（`tick_1hz`）**只在 CLOCK 模式生效**，进入 SET_H/SET_M/ALARM_SET/STOPWATCH 时，真实时间不会继续递增。

---

## 3. “模式–按键–LED显示”对照表

| 模式/状态 | LED 显示内容（4 位轮播） | KEY0 MODE | KEY1 INC | KEY2 DEC | KEY3 FUNC |
|---|---|---|---|---|---|
| **CLOCK（正常走时）** | 默认 **HHMM**（H十→H个→M十→M个） | 切到 SET_H | 无 | 无 | **短按切换页：HHMM↔MMSS**（保持 `PAGE_HOLD_MS` 后自动回 HHMM） |
| **CLOCK：MMSS 页** | **MMSS**（M十→M个→S十→S个） | 切到 SET_H | 无 | 无 | 再按一次回 HHMM（或等待自动回） |
| **SET_H（调小时）** | **HHMM**；正在调的 **H 两位闪烁**（对应轮播位置显示 `1111`） | 切到 SET_M | 小时 +1（23→0） | 小时 -1（0→23） |（当前实现）无额外功能 |
| **SET_M（调分钟）** | **HHMM**；正在调的 **M 两位闪烁** | 切到 ALARM_SET | 分钟 +1（59→0），**秒清零** | 分钟 -1（0→59），**秒清零** |（当前实现）无额外功能 |
| **ALARM_SET：调闹钟小时** | 闹钟 **HHMM**；闹钟 H 两位闪烁 | 切到 STOPWATCH | 闹钟小时 +1（23→0） | 闹钟小时 -1（0→23） | **切换字段：H→M→EN→H** |
| **ALARM_SET：调闹钟分钟** | 闹钟 **HHMM**；闹钟 M 两位闪烁 | 切到 STOPWATCH | 闹钟分钟 +1（59→0） | 闹钟分钟 -1（0→59） | 切换字段 |
| **ALARM_SET：调闹钟使能 EN** | 固定显示 **000(EN)**：`0001`=开，`0000`=关；整体闪烁 | 切到 STOPWATCH | 使能开/关切换 | 使能开/关切换 | 切换字段 |
| **STOPWATCH（秒表）运行** | 秒表 **MMSS**（分十→分个→秒十→秒个） | 回 CLOCK |（当前实现）无 |（当前实现）无 | **短按：开始/暂停**；**长按：清零** |
| **STOPWATCH（秒表）暂停** | **MMSS**；整体闪烁提示暂停 | 回 CLOCK | 无 | 无 | 短按继续；长按清零 |

---

## 4. LED 覆盖优先级（全闪/快闪原因）

| 优先级 | 状态 | LED 表现 | 结束条件 |
|---|---|---|---|
| 最高 | **alarm_active（闹钟触发）** | **快闪**：`0000`/`1111` 交替 | 任意键取消 或 超时 `ALARM_FLASH_MS` |
| 次高 | **chime_active（整点报时）** | **慢闪**：`0000`/`1111` 交替 | 到达 `CHIME_MS` 自动结束 |
| 最低 | 正常显示 | 轮播显示 nibble；CLOCK 下还有“秒反相提示” | 持续 |

---

## 5. 轮播位含义速查

- **HHMM 页（CLOCK/SET_H/SET_M）**
  - `disp_idx=0`：H 十位
  - `disp_idx=1`：H 个位
  - `disp_idx=2`：M 十位
  - `disp_idx=3`：M 个位
- **MMSS 页（CLOCK 的 MMSS 页 / STOPWATCH）**
  - `disp_idx=0`：M 十位（或秒表分十位）
  - `disp_idx=1`：M 个位（或秒表分个位）
  - `disp_idx=2`：S 十位（或秒表秒十位）
  - `disp_idx=3`：S 个位（或秒表秒个位）
